{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between mb-4">
    <h3>Monitor de Produ√ß√£o</h3>
    <a href="{{ url_for('caixa.index') }}" class="btn btn-outline-secondary btn-sm">‚Üê Voltar</a>
</div>

<table class="table table-striped">
    <thead class="table-light">
        <tr>
            <th>OS</th>
            <th>CV</th>
            <th>Cliente</th>
            <th>Status</th>
            <th>A√ß√µes</th>
        </tr>
    </thead>
    <tbody>
        {% for os in ordens %}
        <tr>
            <td>{{ os.os_numero }}</td>
            <td>{{ os.cv_numero or '-' }}</td>
            <td>{{ os.cliente.cli_nome|upper if os.cliente else '-' }}</td>
            <td>
                {# üëá BADGE DE STATUS #}
                {% if os.status == 'venda_concluida' %}
                    <span class="badge bg-info">Venda Conclu√≠da - Servi√ßo na Loja</span>
                {% elif os.status == 'liberado_compra' %}
                    <span class="badge bg-success">Liberado Compra</span>
                {% elif os.status == 'devolucao_quebra_arma√ß√£o' %}
                    <span class="badge bg-warning text-dark">Quebra de Arma√ß√£o</span>
                {% elif os.status == 'servico_montado_conferido' %}
                    <span class="badge bg-success">Servi√ßo Montado e Conferido</span>
                {% elif os.status == 'servico_pronto_entrega' %}
                    <span class="badge bg-primary">Pronto para Entrega</span>
                {% elif os.status == 'garantia' %}
                    <span class="badge bg-warning text-dark">GARANTIA</span>
                {% else %}
                    <span class="badge bg-secondary">{{ os.status|replace('_', ' ')|title }}</span>
                {% endif %}
            </td>
            <td>
                {# üëá A√á√ïES POR STATUS #}
                <a href="{{ url_for('caixa.visualizar_os', os_numero=os.os_numero) }}" 
                   class="btn btn-sm btn-outline-primary me-1">Visualizar</a>

                {% if os.status == 'devolucao_quebra_arma√ß√£o' %}
                    <form method="POST" action="{{ url_for('caixa.reativar_com_nova_arma√ß√£o', os_numero=os.os_numero) }}" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-success"
                                onclick="return confirm('Reativar esta OS para nova arma√ß√£o?')">
                            <i class="bi bi-arrow-clockwise me-1"></i> Nova Arma√ß√£o
                        </button>
                    </form>
                {% elif os.status == 'servico_montado_conferido' %}
                    <form method="POST" action="{{ url_for('caixa.receber_servico', os_numero=os.os_numero) }}" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-info"
                                onclick="return confirm('Confirmar recebimento do servi√ßo?')">
                            <i class="bi bi-check-circle me-1"></i> Receber Servi√ßo
                        </button>
                    </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}