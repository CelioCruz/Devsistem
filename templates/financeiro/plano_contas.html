{% extends "base.html" %}
{% block title %}Plano de Contas{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Cabeçalho -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2><i class="bi bi-clipboard2-check me-2"></i> Plano de Contas</h2>
        <a href="javascript:history.back()" class="btn btn-outline-secondary btn-sm ms-auto">← Voltar</a>
    </div>
        
    <!-- Barra Superior (Toolbar) -->
    <div class="mb-3 d-flex gap-2 flex-wrap">
        <!-- Pesquisa -->
        <button type="button" class="btn btn-outline-primary" id="togglePesquisa">
            <i class="bi bi-search me-1"></i> Pesquisa
        </button>

        <!-- Exibir Seleção -->
        <button type="button" class="btn btn-outline-info" id="toggleSelecao">
            <i class="bi bi-list-check me-1"></i> Exibir Seleção
        </button>

        <!-- Conferência -->
        <button type="button" class="btn btn-outline-success" id="conferenciaBtn">
            <i class="bi bi-bank2 me-1"></i> Conferência
        </button>

        <!-- Imprimir -->
        <button type="button" class="btn btn-outline-warning" id="imprimirBtn">
            <i class="bi bi-printer me-1"></i> Imprimir
        </button>

        <!-- Créditos -->
        <button type="button" class="btn btn-outline-danger" id="creditosBtn">
            <i class="bi bi-cash-stack me-1"></i> Créditos
        </button>

        <!-- Ferramentas -->
        <div class="dropdown">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="ferramentasDropdown" data-bs-toggle="dropdown">
                <i class="bi bi-tools me-1"></i> Ferramentas
            </button>
            <ul class="dropdown-menu" aria-labelledby="ferramentasDropdown">
                <li><a class="dropdown-item" href="#">Configurar Filtros</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Importar Contas</a></li>
                <li><a class="dropdown-item" href="#">Exportar Contas</a></li>
            </ul>
        </div>

    <!-- Divisão Principal: Painel Esquerdo + Tabela -->
    <div class="row">
        <!-- Painel Esquerdo (Filtros) -->
        <div class="col-md-3" id="painelFiltros">
            <div class="card">
                <div class="card-header bg-light">
                    <strong>Pesquisa</strong>
                </div>
                <div class="card-body">
                    <!-- Empresa -->
                    <div class="mb-3">
                        <label class="form-label">Empresa (CTRL + A selecionar todas):</label>
                        <select name="empresa" class="form-select">
                            <option value="">DINIZ PINHEIRO</option>
                            <!-- Adicione outras empresas aqui -->
                        </select>
                    </div>

                    <!-- Situação -->
                    <div class="mb-3">
                        <label class="form-label">Situação:</label>
                        <select name="situacao" class="form-select">
                            <option value="">Em aberto (sem data de pagamento)</option>
                            <option value="vencidas">Vencidas</option>
                            <option value="pagas">Pagas</option>
                        </select>
                    </div>

                    <!-- Tipo -->
                    <div class="mb-3">
                        <label class="form-label">Tipo:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="tipo" id="tipoTantoFaz" value="tanto_faz" checked>
                            <label class="form-check-label" for="tipoTantoFaz">Tanto faz</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="tipo" id="tipoPagar" value="pagar">
                            <label class="form-check-label" for="tipoPagar">Pagar</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="tipo" id="tipoReceber" value="receber">
                            <label class="form-check-label" for="tipoReceber">Receber</label>
                        </div>
                    </div>

                    <!-- Cliente/Fornecedor -->
                    <div class="mb-3">
                        <label class="form-label">Cliente / fornecedor:</label>
                        <div class="input-group">
                            <input type="text" name="cliente" class="form-control" placeholder="Nome">
                            <button class="btn btn-outline-secondary" type="button">
                                <i class="bi bi-person"></i>
                            </button>
                            <button class="btn btn-outline-secondary" type="button">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Número do documento -->
                    <div class="mb-3">
                        <label class="form-label">Número documento (usar "|" como separador):</label>
                        <div class="input-group">
                            <input type="text" name="numero_documento" class="form-control">
                            <button class="btn btn-outline-secondary" type="button">
                                <i class="bi bi-file-earmark-text"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Filtros Avançados -->
                    <div class="accordion mb-3" id="filtrosAvancados">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#filtroDatas">
                                    Datas
                                </button>
                            </h2>
                            <div id="filtroDatas" class="accordion-collapse collapse" data-bs-parent="#filtrosAvancados">
                                <div class="accordion-body">
                                    <div class="mb-2">
                                        <label class="form-label">Data inicial:</label>
                                        <input type="date" name="data_inicial" class="form-control">
                                    </div>
                                    <div class="mb-2">
                                        <label class="form-label">Data final:</label>
                                        <input type="date" name="data_final" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#filtroBanco">
                                    Banco | PIX
                                </button>
                            </h2>
                            <div id="filtroBanco" class="accordion-collapse collapse" data-bs-parent="#filtrosAvancados">
                                <div class="accordion-body">
                                    <select name="banco" class="form-select">
                                        <option value="">Todos</option>
                                        <option value="bradesco">Bradesco</option>
                                        <option value="itau">Itaú</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#filtroCarnê">
                                    Carnê
                                </button>
                            </h2>
                            <div id="filtroCarnê" class="accordion-collapse collapse" data-bs-parent="#filtrosAvancados">
                                <div class="accordion-body">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="carnêSim">
                                        <label class="form-check-label" for="carnêSim">Sim</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#filtroCartao">
                                    Cartão de crédito | Financeira
                                </button>
                            </h2>
                            <div id="filtroCartao" class="accordion-collapse collapse" data-bs-parent="#filtrosAvancados">
                                <div class="accordion-body">
                                    <select name="cartao" class="form-select">
                                        <option value="">Todos</option>
                                        <option value="visa">Visa</option>
                                        <option value="master">Mastercard</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#filtroEspeciais">
                                    Especiais
                                </button>
                            </h2>
                            <div id="filtroEspeciais" class="accordion-collapse collapse" data-bs-parent="#filtrosAvancados">
                                <div class="accordion-body">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="especial1">
                                        <label class="form-check-label" for="especial1">Especial 1</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="especial2">
                                        <label class="form-check-label" for="especial2">Especial 2</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botões de Limpar e Pesquisar -->
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-secondary w-50">Limpar</button>
                        <button type="button" class="btn btn-primary w-50">
                            <i class="bi bi-search"></i> Pesquisar (F3)
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabela Principal -->
        <div class="col-md-9">
            <div class="card">
                <div class="card-header bg-light">
                    <strong>Plano de contas</strong>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Nº Doc</th>
                                    <th>Emissão</th>
                                    <th>Vencimento</th>
                                    <th>Pagamento</th>
                                    <th>Recebimento</th>
                                    <th>Vencimento original</th>
                                    <th>V. Original</th>
                                    <th>Juros</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if contas %}
                                    {% for conta in contas %}
                                    <tr>
                                        <td>{{ conta.cliente.cli_nome if conta.cliente else conta.fornecedor.forn_razao if conta.fornecedor else '–' }}</td>
                                        <td>{{ conta.cr_numero or conta.cp_numero }}</td>
                                        <td>{{ conta.cr_data_emissao.strftime('%d/%m/%Y') if conta.cr_data_emissao else conta.cp_data_emissao.strftime('%d/%m/%Y') if conta.cp_data_emissao else '–' }}</td>
                                        <td>{{ conta.cr_data_vencimento.strftime('%d/%m/%Y') if conta.cr_data_vencimento else conta.cp_data_vencimento.strftime('%d/%m/%Y') if conta.cp_data_vencimento else '–' }}</td>
                                        <td>{{ conta.cr_data_pagamento.strftime('%d/%m/%Y') if conta.cr_data_pagamento else '–' }}</td>
                                        <td>{{ conta.cp_data_pagamento.strftime('%d/%m/%Y') if conta.cp_data_pagamento else '–' }}</td>
                                        <td>{{ conta.cr_data_vencimento.strftime('%d/%m/%Y') if conta.cr_data_vencimento else conta.cp_data_vencimento.strftime('%d/%m/%Y') if conta.cp_data_vencimento else '–' }}</td>
                                        <td>R$ {{ "%.2f"|format(conta.cr_valor) if conta.cr_reg else "%.2f"|format(conta.cp_valor) if conta.cp_reg else '0,00' }}</td>
                                        <td>R$ 0,00</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="9" class="text-center">Nenhuma conta encontrada.</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Rodapé com totais -->
                    <div class="border-top pt-3">
                        <div class="row">
                            <div class="col-md-3">
                                <p><strong>Lançamentos: 03</strong></p>
                            </div>
                            <div class="col-md-3">
                                <p>Aberto(C): R$ 849,00</p>
                            </div>
                            <div class="col-md-3">
                                <p>Total aberto(C-D): R$ 849,00</p>
                            </div>
                            <div class="col-md-3 text-end">
                                <button type="button" class="btn btn-sm btn-outline-primary">Filtrar...</button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <p>Juros (C-D): R$ 0,00</p>
                            </div>
                            <div class="col-md-3">
                                <p>Desconto (C-D): R$ 0,00</p>
                            </div>
                            <div class="col-md-3">
                                <p>Original (C-D): R$ 849,00</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Aba Inferior (Exibir Seleção) -->
    <div class="card mt-3 d-none" id="abaSelecao">
        <div class="card-header bg-light">
            <strong>Utilizar crédito</strong>
        </div>
        <div class="card-body">
            <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i> Selecione as contas para agrupamento ou baixa.
            </div>
        </div>
    </div>
</div>

<!-- Script para controlar os botões -->
<script>
document.getElementById('togglePesquisa').addEventListener('click', function() {
    document.getElementById('painelFiltros').classList.toggle('d-none');
});

document.getElementById('toggleSelecao').addEventListener('click', function() {
    const aba = document.getElementById('abaSelecao');
    aba.classList.toggle('d-none');
});

document.getElementById('conferenciaBtn').addEventListener('click', function() {
    alert('Funcionalidade em desenvolvimento.');
});

document.getElementById('imprimirBtn').addEventListener('click', function() {
    window.print();
});

document.getElementById('creditosBtn').addEventListener('click', function() {
    alert('Funcionalidade em desenvolvimento.');
});
</script>
{% endblock %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const tipo = urlParams.get('tipo');
    
    if (tipo === 'receber') {
        document.getElementById('tipoReceber').checked = true;
    } else if (tipo === 'pagar') {
        document.getElementById('tipoPagar').checked = true;
    }
});
</script>